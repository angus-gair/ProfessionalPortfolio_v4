{% extends 'base.html' %}

{% block title %}Portfolio Ecosystem Diagram - Angus Gair{% endblock %}
{% block page_category %}ecosystem{% endblock %}

{% block extra_css %}
<style>
  .ecosystem-section {
    margin-bottom: 5rem;
  }
  
  .diagram-container {
    background-color: white;
    padding: 2rem;
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border: 1px solid #e5e7eb;
    margin-top: 1.5rem;
    transition: all 0.3s ease;
  }
  
  .ecosystem-diagram {
    width: 100%;
    height: auto;
    cursor: pointer;
    transition: transform 0.3s ease;
  }
  
  /* Modal styling */
  .modal-backdrop {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }
  
  .modal-container {
    position: relative;
    max-width: 90%;
    max-height: 90%;
    overflow: auto;
    background-color: white;
    border-radius: 8px;
    padding: 20px;
  }
  
  .modal-close {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 30px;
    cursor: pointer;
    color: #333;
    z-index: 1010;
  }
  
  .modal-content img {
    width: 100%;
    height: auto;
  }
  
  .image-button {
    display: block;
    margin: 20px auto 0;
    padding: 12px 24px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  
  .image-button:hover {
    background-color: #0056b3;
  }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
  <!-- Header section -->
  <header class="text-center mb-5">
    <h1 class="display-4 fw-bold mb-4">Portfolio Ecosystem</h1>
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <p class="lead text-muted">
          This diagram illustrates the current ecosystem of the portfolio website,
          showcasing how different components interact with each other to create
          a comprehensive and functional system. It includes both current implementations
          and potential future integrations.
        </p>
      </div>
    </div>
  </header>
  
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <!-- Ecosystem Diagram Section -->
      <section class="ecosystem-section">
        <h2 class="h2 fw-bold mb-3">Current Ecosystem</h2>
        <p class="text-muted mb-4">
          The portfolio website implements a Flask-based web application that integrates with
          external APIs (GitHub, Tableau) and utilizes Google Tag Manager for advanced analytics tracking.
          The diagram below shows how these components are connected and interact with each other.
        </p>
        <div class="diagram-container" id="diagram-container">
          <iframe id="ecosystem-diagram" class="ecosystem-diagram" src="{{ url_for('ecosystem_diagram') }}" style="width: 100%; height: 500px; border: none;" title="Portfolio Ecosystem Diagram"></iframe>
          <div class="text-center mt-4" style="margin-top: 30px !important; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
            <button id="enlarge-diagram" class="btn btn-primary btn-lg" style="font-size: 1.2rem; padding: 12px 25px;">
              <i class="bi bi-arrows-fullscreen me-2"></i> Enlarge Diagram
            </button>
          </div>
        </div>
      </section>
      
      <!-- Components Description Section -->
      <section class="ecosystem-section">
        <h2 class="h2 fw-bold mb-3">Key Components & Technical Details</h2>
        <p class="text-muted mb-4">
          The ecosystem incorporates several critical components that work together to provide a comprehensive 
          portfolio website. Each component has been selected for its technical capabilities, scalability, and 
          integration potential.
        </p>
        <ul class="mt-4">
          <li class="mb-3">
            <strong>Core Application:</strong> Flask web application framework
            <div class="text-muted ms-3">Serves the entire portfolio website with routes for different sections</div>
          </li>
          <li class="mb-3">
            <strong>Static Content:</strong> HTML, CSS, JavaScript, Images
            <div class="text-muted ms-3">Jinja2 templates, Bootstrap 5 styling, interactive JavaScript elements</div>
          </li>
          <li class="mb-3">
            <strong>External APIs:</strong> GitHub, Tableau Public
            <div class="text-muted ms-3">Server-side API integration to fetch data dynamically</div>
          </li>
          <li class="mb-3">
            <strong>Analytics & Tracking:</strong> GTM + GA4
            <div class="text-muted ms-3">Comprehensive event tracking for user interactions and engagement</div>
          </li>
          <li class="mb-3">
            <strong>Future Integrations:</strong> SuiteCRM, Email Services, Cloud Storage
            <div class="text-muted ms-3">Planned additions to enhance functionality and user experience</div>
          </li>
        </ul>
      </section>
      
      <!-- Additional Information -->
      <section class="ecosystem-section">
        <h2 class="h2 fw-bold mb-3">Development & Implementation Notes</h2>
        <p class="text-muted mb-4">
          The portfolio website follows a modular architecture for maintainability and extensibility.
          Below are some key implementation details that help understand how the system was built.
        </p>
        <ul class="mt-4">
          <li class="mb-3">
            <strong>API Integration Strategy:</strong>
            <div class="text-muted ms-3">Server-side API calls with appropriate authentication and error handling</div>
          </li>
          <li class="mb-3">
            <strong>Analytics Implementation:</strong>
            <div class="text-muted ms-3">DataLayer-based event tracking with custom event definitions</div>
          </li>
          <li class="mb-3">
            <strong>Design Patterns:</strong>
            <div class="text-muted ms-3">MVC architecture with separation of routes, templates, and static assets</div>
          </li>
          <li class="mb-3">
            <strong>Security Considerations:</strong>
            <div class="text-muted ms-3">API tokens stored as environment variables, path validation for file access</div>
          </li>
        </ul>
      </section>
    </div>
  </div>
</div>

<!-- Image Modal -->
<div id="image-modal" class="modal-backdrop">
  <div class="modal-container">
    <span class="modal-close">&times;</span>
    <div class="modal-content" style="width: 90%; height: 90%;">
      <iframe id="expanded-iframe" src="{{ url_for('ecosystem_diagram') }}" style="width: 100%; height: 100%; border: none;" title="Expanded Portfolio Ecosystem Diagram"></iframe>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const diagramImage = document.getElementById('ecosystem-diagram');
    const enlargeButton = document.getElementById('enlarge-diagram');
    const modal = document.getElementById('image-modal');
    const closeButton = document.querySelector('.modal-close');
    
    // Function to log diagram interaction
    function logDiagramInteraction(action) {
      console.log(`Diagram interaction: ${action}`);
      // If dataLayer is available, push the event
      if (typeof window.dataLayer !== 'undefined') {
        window.dataLayer.push({
          'event': 'diagram_interaction',
          'action': action,
          'diagram_type': 'ecosystem',
          'page': 'ecosystem'  
        });
      }
    }
    
    // Handle diagram click - log the interaction
    diagramImage.addEventListener('click', function() {
      logDiagramInteraction('clicked');
      modal.style.display = 'flex';
    });
    
    // Handle enlarge button click
    enlargeButton.addEventListener('click', function() {
      modal.style.display = 'flex';
      logDiagramInteraction('enlarged');
    });
    
    // Close the modal when clicking the close button
    closeButton.addEventListener('click', function() {
      modal.style.display = 'none';
      logDiagramInteraction('closed_enlarged');
    });
    
    // Close modal when clicking outside the image
    modal.addEventListener('click', function(event) {
      if (event.target === modal) {
        modal.style.display = 'none';
        logDiagramInteraction('closed_enlarged');
      }
    });
    
    // Close modal on ESC key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape' && modal.style.display === 'flex') {
        modal.style.display = 'none';
        logDiagramInteraction('closed_enlarged_esc');
      }
    });
  });
</script>
{% endblock %}