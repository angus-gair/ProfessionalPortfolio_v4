{% extends 'base.html' %}

{% block title %}Portfolio Ecosystem Diagram - Angus Gair{% endblock %}
{% block page_category %}ecosystem{% endblock %}

{% block extra_css %}
<style>
  .ecosystem-section {
    margin-bottom: 5rem;
  }
  .diagram-container {
    background-color: white;
    padding: 2rem;
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border: 1px solid #e5e7eb;
    margin-top: 1.5rem;
    transition: all 0.3s ease;
  }
  /* Modal styling for enlarged diagram */
  .diagram-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.85);
    z-index: 1000;
    overflow: auto;
    padding: 2rem;
    align-items: center;
    justify-content: center;
  }
  .diagram-modal-content {
    background-color: white;
    margin: auto;
    max-width: 90%;
    width: 90%;
    height: 90%;
    padding: 2rem;
    border-radius: 0.5rem;
    position: relative;
    overflow: auto;
  }
  
  .diagram-close {
    position: absolute;
    top: 15px;
    right: 15px;
    font-size: 30px;
    font-weight: bold;
    color: #333;
    cursor: pointer;
    z-index: 1001;
  }
  
  #enlarged-diagram {
    width: 100%;
    height: 100%;
  }
  #ecosystem-diagram {
    cursor: pointer;
  }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
  <header class="text-center mb-5">
    <h1 class="display-4 fw-bold mb-4">Portfolio Ecosystem</h1>
    <p class="lead text-muted">
      This diagram illustrates the current ecosystem of the portfolio website.
    </p>
  </header>
  
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <section class="ecosystem-section">
        <h2 class="h2 fw-bold mb-3">Current Ecosystem</h2>
        <div class="diagram-container" id="diagram-container">
          <div class="mermaid" id="ecosystem-diagram" data-original="graph TD
                A[Main Portfolio Website\nFlask Application] --> B[Static Content]
                A --> C[Dynamic Content]
                A --> G[Google Tag Manager Integration]">
            graph TD
                A[Main Portfolio Website\nFlask Application] --> B[Static Content]
                A --> C[Dynamic Content]
                A --> G[Google Tag Manager Integration]
          </div>
          <div class="text-center mt-4" style="margin-top: 30px !important; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
            <button id="enlarge-diagram" class="btn btn-primary btn-lg" style="font-size: 1.2rem; padding: 12px 25px;">
              <i class="bi bi-arrows-fullscreen me-2"></i> Enlarge Diagram
            </button>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    mermaid.initialize({
      startOnLoad: true,
      theme: 'default',
      securityLevel: 'loose'
    });
    
    // Create modal element for enlarged diagram
    const modal = document.createElement('div');
    modal.className = 'diagram-modal';
    modal.style.display = 'none';
    modal.style.alignItems = 'center'; 
    modal.style.justifyContent = 'center';
    modal.innerHTML = `
      <div class="diagram-modal-content">
        <span class="diagram-close">&times;</span>
        <div id="enlarged-diagram" class="mermaid"></div>
      </div>
    `;
    document.body.appendChild(modal);
    
    const ecosystemDiagram = document.getElementById('ecosystem-diagram');
    const enlargeButton = document.getElementById('enlarge-diagram');
    const enlargedDiagram = document.getElementById('enlarged-diagram');
    const closeButton = modal.querySelector('.diagram-close');
    
    // Log diagram interaction
    function logDiagramInteraction(action) {
      console.log(`Diagram interaction: ${action}`);
      if (typeof window.dataLayer !== 'undefined') {
        window.dataLayer.push({
          'event': 'diagram_interaction',
          'action': action,
          'diagram_type': 'ecosystem',
          'page': 'ecosystem'  
        });
      }
    }
    
    // Handle diagram click
    ecosystemDiagram.addEventListener('click', function() {
      logDiagramInteraction('clicked');
    });
    
    // Handle enlarge button click
    enlargeButton.addEventListener('click', function() {
      // Get the original diagram source code, not the processed HTML
      const diagramCode = ecosystemDiagram.getAttribute('data-original') || 
                         'graph TD\n  A[Main Portfolio Website] --> B[Static Content]\n  A --> C[Dynamic Content]';
      
      // Set the diagram content
      enlargedDiagram.textContent = diagramCode;
      
      // Show the modal
      modal.style.display = 'flex';
      
      // Render the enlarged diagram
      mermaid.init(undefined, enlargedDiagram);
      
      logDiagramInteraction('enlarged');
    });
    
    // Close modal
    closeButton.addEventListener('click', function() {
      modal.style.display = 'none';
      logDiagramInteraction('closed_enlarged');
    });
  });
</script>
{% endblock %}